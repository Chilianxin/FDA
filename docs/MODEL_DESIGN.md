# 模型架构与设计交流（草案）

> 说明：此文档用于与协作者/审稿人交流本论文在金融领域的深度学习建模思路、系统架构与复现要点。请在评审过程中直接在对应章节下评论或补充。

## 1. 问题定义与场景
- 目标任务：例如，资产价格方向预测/收益率回归/风险因子挖掘/异常检测/信用评分等。
- 数据来源：交易级别数据、K 线/Bar 数据、基本面财报、新闻与研报、另类数据（情绪、ESG等）。
- 预测窗口与频率：例如日频/分钟级；滚动窗口大小、滞后期、对齐规则。
- 评估标准：分类（AUC/F1/PR-AUC）、回归（MSE/MAE/R2）、投资绩效（年化收益、夏普比率、最大回撤、信息比率、换手率等）。

## 2. 数据与特征工程
- 原始数据结构与字段对齐规则（见 `docs/DATA.md`）。
- 缺失值、异常值、停牌/复权、货币/时区统一处理。
- 特征类型：
  - 横截面因子（估值、成长、质量、情绪、技术指标）
  - 时序特征（过去 N 日收益率、波动率、成交量变化等）
  - 文本/新闻（情感分数、主题分布）
  - 图结构（行业/供应链/持股关联图）
- 归一化与标准化：滚动/在线标准化，训练/验证分割泄露防护。
- 特征选择/降维：IC 筛选、Lasso、PCA、AutoEncoder。

## 3. 模型总体架构
- 输入层：多模态拼接（数值、时间序列、文本、图）。
- 表征模块：
  - 时序：TCN/Temporal Fusion Transformer/LSTM/Informer
  - 截面：MLP/因子加权/TabTransformer
  - 文本：FinBERT/Longformer/Domain-adapted LLM Embeddings
  - 图：GCN/GAT/HGT（行业/持股/资金流网络）
- 融合策略：
  - 早期融合：拼接后统一编码
  - 晚期融合：各子模型打分后加权/Stacking
  - 注意力门控：根据市场状态自适应加权
- 任务头：
  - 分类头：Sigmoid/Softmax
  - 回归头：线性层
  - 多任务：共享干路+任务专用头

## 4. 损失函数与训练目标
- 分类：BCE、Focal Loss、AUC Maximization（Pairwise）
- 回归：MSE/Huber/Quantile Loss（对冲下行风险）
- 投资目标：
  - 约束优化：暴露中性（行业/风格/市值），换手率约束
  - 直接优化投资指标：最大化夏普/信息比率的近似可微代理

## 5. 训练与验证流程
- 数据切分：时间序列嵌套交叉验证（Purged K-Fold）、滚动/扩展窗口回测。
- 数据泄露防护：特征计算窗口与标签对齐、不可见未来信息隔离。
- 超参搜索：Optuna/Weights & Biases，贝叶斯优化。
- 早停与正则：EarlyStopping、Dropout、Weight Decay。
- 可重复性：固定随机种子、环境与依赖锁定（`requirements.txt`）。

## 6. 投资组合与回测
- 排序-分组法：多空组合、分位数组合、IC/RankIC 评估。
- 组合构建：均值-方差、风险平价、最小方差、约束最优化（cvxpy）。
- 交易成本：冲击成本+摩擦成本建模，滑点模拟。
- 风险控制：行业/风格中性、VaR/CVaR 约束、持仓与换手上限。

## 7. 系统与工程实现
- 目录结构：见根目录 `README.md` 与 `docs/USAGE.md`。
- 配置管理：`configs/config.yaml`，区分数据、模型、实验参数；支持多环境 Profile。
- 日志与可视化：`experiments/logs`，TensorBoard/W&B。
- 模型保存与版本：`models/checkpoints` 与 `models/artifacts`。
- 脚本：`scripts/train.sh`、`scripts/evaluate.sh`、`scripts/download_data.sh`。

## 8. 结果与可解释性
- 因子暴露分析：与传统风格因子相关性、IC 路径。
- 可解释方法：SHAP、注意力权重热力、时序归因（TCN/Transformer）。
- 事件分析：重大公告/财报窗口下的表现稳定性。

## 9. 复现实验清单
- 数据版本号、时间区间、资产池、特征集版本。
- 模型配置哈希与随机种子。
- 关键结果图表：收益曲线、回撤、分组收益、IC/RankIC、稳定性评估。

## 10. 风险与合规
- 数据合规与许可约束说明。
- 可发布的开源协议与二次分发限制。

---

附：后续将根据实际实现补充：
- 具体模型模块的结构图
- 配置样例与命令行参数
- 主要类与函数的调用关系
