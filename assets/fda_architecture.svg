<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="680" viewBox="0 0 1100 680">
  <defs>
    <style>
      .box { fill:#ffffff; stroke:#1f2937; stroke-width:2; rx:10; ry:10; }
      .title { font: 700 18px sans-serif; fill:#111827; }
      .text { font: 400 14px sans-serif; fill:#374151; }
      .arrow { stroke:#2563eb; stroke-width:2.5; marker-end:url(#arrowHead); fill:none; }
      .arrow2 { stroke:#10b981; stroke-width:2.5; marker-end:url(#arrowHead); fill:none; stroke-dasharray:6 6; }
      .arrow3 { stroke:#ef4444; stroke-width:2.5; marker-end:url(#arrowHead); fill:none; stroke-dasharray:4 4; }
    </style>
    <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
      <polygon points="0 0, 10 5, 0 10" fill="#2563eb"/>
    </marker>
  </defs>

  <!-- Data -->
  <rect class="box" x="40" y="40" width="240" height="120"/>
  <text class="title" x="60" y="70">源数据 Data</text>
  <text class="text" x="60" y="100">• 行情：价/量/额/收益</text>
  <text class="text" x="60" y="122">• 流动性/估值/广度</text>
  <text class="text" x="60" y="144">• 资金流/意图（如有）</text>

  <!-- Graphs (NGC) -->
  <rect class="box" x="320" y="40" width="300" height="120"/>
  <text class="title" x="340" y="70">动态图 NGC</text>
  <text class="text" x="340" y="100">• Neural Granger (组套索)</text>
  <text class="text" x="340" y="122">• Moralize → 无向图</text>
  <text class="text" x="340" y="144">• edge_index/weight</text>

  <!-- Predictor -->
  <rect class="box" x="40" y="220" width="580" height="160"/>
  <text class="title" x="60" y="250">预测模块 Predictor</text>
  <text class="text" x="60" y="280">• 股票内 SAT-FAN（时频增强 + 多尺度 TCN + 注意力）</text>
  <text class="text" x="60" y="304">• 股票间 RGAT（稀疏注意力，使用 edge_index/weight）</text>
  <text class="text" x="60" y="328">• 融合 Fusion → h</text>
  <text class="text" x="60" y="352">• 输出：mu / quantiles / uncertainty / styles / rl_state</text>

  <!-- Market Model -->
  <rect class="box" x="660" y="220" width="400" height="200"/>
  <text class="title" x="680" y="250">市场模块 MarketModel</text>
  <text class="text" x="680" y="280">• Regime(HMM) → 宏观 z_macro / regime_probs</text>
  <text class="text" x="680" y="302">• Probe + MILAN → impact_costs</text>
  <text class="text" x="680" y="324">• 回报分解：r_norm + r_impact = r_total_pred</text>
  <text class="text" x="680" y="346">• 输入含 trading intention（由动作生成）</text>

  <!-- RL -->
  <rect class="box" x="60" y="430" width="500" height="200"/>
  <text class="title" x="80" y="460">强化学习 DQN + XRL</text>
  <text class="text" x="80" y="490">• 状态：rl_state ∥ {z_macro, risk, r_norm, r_impact, impact_costs}</text>
  <text class="text" x="80" y="512">• 奖励：PnL − impact_costs（impact-aware）</text>
  <text class="text" x="80" y="534">• 决策可解释：SHAP Top-K 驱动特征</text>

  <!-- Execution/Env -->
  <rect class="box" x="600" y="470" width="300" height="120"/>
  <text class="title" x="620" y="500">执行/环境</text>
  <text class="text" x="620" y="530">• 交易施行/成本结算</text>

  <!-- Arrows -->
  <!-- Data to NGC -->
  <path class="arrow" d="M 280 100 L 320 100"/>
  <!-- Data to Predictor -->
  <path class="arrow" d="M 160 160 L 160 220"/>
  <!-- NGC to Predictor -->
  <path class="arrow" d="M 470 160 L 470 220"/>
  <!-- Predictor to RL -->
  <path class="arrow" d="M 330 380 L 330 430"/>
  <!-- Market to RL -->
  <path class="arrow" d="M 720 420 L 520 520"/>
  <!-- RL to Market (intention) -->
  <path class="arrow2" d="M 300 520 C 400 520, 600 380, 760 340"/>
  <!-- RL to Execution -->
  <path class="arrow" d="M 560 520 L 600 520"/>
  <!-- Execution to Data (feedback loop, stylized) -->
  <path class="arrow3" d="M 750 590 C 780 640, 200 640, 160 160"/>

  <!-- Legend -->
  <text class="text" x="860" y="640">蓝色：前向数据流  绿色：意图回流  红色：闭环反馈</text>
</svg>

